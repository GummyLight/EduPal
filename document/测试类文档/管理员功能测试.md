# 管理员功能API测试文档

## 测试环境配置
- **后端服务地址**: `http://localhost:8080`
- **测试时间**: 2025年6月2日
- **测试工具**: curl命令行工具
- **前置条件**: 确保后端服务已启动并连接到数据库

---

## 1. 用户注册功能测试

### 1.1 注册学生用户
```bash
# 正常注册学生 - 基本信息完整
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=s20250113&userName=孙梓康&password=123456&email=1063046101@qq.com&userType=1&studentClass=2503&studentGender=0" \
  http://localhost:8080/admin/register

# 预期结果: {"code":200,"message":"学生注册成功"}
```

```bash
# 注册学生 - 测试必填字段缺失
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=&userName=张小明&password=123456&email=zhangxm@test.com&userType=1" \
  http://localhost:8080/admin/register

# 预期结果: {"code":400,"message":"用户ID不能为空"}
```

```bash
# 注册学生 - 重复用户ID
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=s20250602001&userName=李小红&password=123456&email=lixh@test.com&userType=1&studentClass=高一2班&studentGender=2" \
  http://localhost:8080/admin/register

# 预期结果: {"code":400,"message":"用户ID已存在"}
```

### 1.2 注册教师用户
```bash
# 正常注册教师 - 单个班级
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=t20250602001&userName=王老师&password=123456&email=wangteacher@test.com&userType=2&teachingSubject=数学&teacherClass=高一1班" \
  http://localhost:8080/admin/register

# 预期结果: {"code":200,"message":"教师注册成功"}
```

```bash
# 注册教师 - 多个班级
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=t20250602002&userName=李老师&password=123456&email=liteacher@test.com&userType=2&teachingSubject=语文&teacherClass=高一1班&teacherClass=高一2班&teacherClass=高一3班" \
  http://localhost:8080/admin/register

# 预期结果: {"code":200,"message":"教师注册成功"}
```

### 1.3 注册管理员用户
```bash
# 注册管理员
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=admin20250602&userName=管理员张&password=adminpass123&email=admin@test.com&userType=0" \
  http://localhost:8080/admin/register

# 预期结果: {"code":200,"message":"管理员注册成功"}
```

---

## 2. 用户信息查询功能测试

### 2.1 查询所有用户
```bash
# 获取用户列表
curl -X GET http://localhost:8080/admin/listUsers

# 预期结果: 返回包含所有用户信息的JSON对象
# {
#   "status": "success",
#   "message": "获取用户列表成功",
#   "userNum": 4,
#   "users": [...]
# }
```

### 2.2 查询所有学生
```bash
# 获取学生列表
curl -X GET http://localhost:8080/admin/listStudents

# 预期结果: 返回包含所有学生信息的JSON对象
# {
#   "status": "success", 
#   "message": "获取学生列表成功",
#   "studentNum": 1,
#   "students": [...]
# }
```

### 2.3 查询所有教师
```bash
# 获取教师列表
curl -X GET http://localhost:8080/admin/listTeachers

# 预期结果: 返回包含所有教师信息的JSON对象
# {
#   "status": "success",
#   "message": "获取教师列表成功", 
#   "teacherNum": 2,
#   "teachers": [...]
# }
```

---

## 3. 用户信息更新功能测试

### 3.1 更新用户基本信息
```bash
# 正常更新用户信息
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=s20250602001&newUserName=张小明新&newEmail=zhangxm_new@test.com&newPassword=newpass123" \
  http://localhost:8080/admin/update

# 预期结果: {"code":200,"message":"用户信息更新成功"}
```

```bash
# 更新不存在的用户
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=nonexistent&newUserName=测试&newEmail=test@test.com&newPassword=123456" \
  http://localhost:8080/admin/update

# 预期结果: {"code":400,"message":"用户不存在"}
```

### 3.2 更新学生班级
```bash
# 正常更新学生班级
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "studentId=s20250602001&newClassId=高一3班" \
  http://localhost:8080/admin/updateStudentClass

# 预期结果: {"code":200,"message":"学生班级更新成功"}
```

```bash
# 更新不存在学生的班级
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "studentId=nonexistent&newClassId=高一1班" \
  http://localhost:8080/admin/updateStudentClass

# 预期结果: {"code":400,"message":"学生不存在"}
```

### 3.3 更新教师授课班级
```bash
# 正常更新教师班级
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "teacherId=t20250602001&newClass=高二1班&newClass=高二2班" \
  http://localhost:8080/admin/updateTeacherClass

# 预期结果: {"code":200,"message":"教师班级更新成功"}
```

```bash
# 清空教师班级（传入空数组）
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "teacherId=t20250602001" \
  http://localhost:8080/admin/updateTeacherClass

# 预期结果: {"code":200,"message":"教师班级更新成功"}
```

### 3.4 更新教师教学科目
```bash
# 正常更新教师科目
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "teacherId=t20250602002&newSubject=物理" \
  http://localhost:8080/admin/updateTeacherSubject

# 预期结果: {"code":200,"message":"教师科目更新成功"}
```

```bash
# 更新不存在教师的科目
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "teacherId=nonexistent&newSubject=化学" \
  http://localhost:8080/admin/updateTeacherSubject

# 预期结果: {"code":400,"message":"教师不存在"}
```

---

## 4. 用户删除功能测试

### 4.1 删除学生账户
```bash
# 正常删除学生
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userType=1&userId=s20250602001" \
  http://localhost:8080/admin/delete

# 预期结果: {"code":200,"message":"学生账户删除成功"}
```

### 4.2 删除教师账户
```bash
# 正常删除教师
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userType=2&userId=t20250602001" \
  http://localhost:8080/admin/delete

# 预期结果: {"code":200,"message":"教师账户删除成功"}
```

### 4.3 删除不存在的用户
```bash
# 删除不存在的用户
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userType=1&userId=nonexistent" \
  http://localhost:8080/admin/delete

# 预期结果: {"code":400,"message":"用户不存在"}
```

---

## 5. 边界条件和异常测试

### 5.1 参数验证测试
```bash
# 无效的用户类型
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=test123&userName=测试&password=123456&email=test@test.com&userType=99" \
  http://localhost:8080/admin/register

# 预期结果: {"code":400,"message":"无效的用户类型"}
```

```bash
# 邮箱格式验证
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=test124&userName=测试&password=123456&email=invalid-email&userType=1" \
  http://localhost:8080/admin/register

# 预期结果: {"code":400,"message":"邮箱格式不正确"}
```

### 5.2 空参数测试
```bash
# 所有参数为空
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "" \
  http://localhost:8080/admin/register

# 预期结果: {"code":400,"message":"必填参数不能为空"}
```

### 5.3 特殊字符测试
```bash
# 用户名包含特殊字符
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=test125&userName=测试<script>&password=123456&email=test@test.com&userType=1" \
  http://localhost:8080/admin/register

# 预期结果: {"code":400,"message":"用户名包含非法字符"}
```

---

## 6. 性能和并发测试

### 6.1 批量操作测试
```bash
# 快速连续注册多个用户（可用脚本执行）
for i in {1..10}; do
  curl -X POST \
    -H "Content-Type: application/x-www-form-urlencoded" \
    -d "userId=batch_s$i&userName=批量学生$i&password=123456&email=batch$i@test.com&userType=1&studentClass=测试班" \
    http://localhost:8080/admin/register
  sleep 0.1
done
```

### 6.2 大量数据查询测试
```bash
# 查询用户列表（在有大量用户的情况下）
time curl -X GET http://localhost:8080/admin/listUsers

# 预期: 响应时间应在合理范围内（< 2秒）
```

---

## 7. 集成测试场景

### 7.1 完整用户生命周期测试
```bash
# 1. 注册用户
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=lifecycle_test&userName=生命周期测试&password=123456&email=lifecycle@test.com&userType=1&studentClass=测试班&studentGender=1" \
  http://localhost:8080/admin/register

# 2. 查询用户确认存在
curl -X GET http://localhost:8080/admin/listStudents

# 3. 更新用户信息
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userId=lifecycle_test&newUserName=生命周期测试更新&newEmail=lifecycle_new@test.com&newPassword=newpass123" \
  http://localhost:8080/admin/update

# 4. 更新学生班级
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "studentId=lifecycle_test&newClassId=新测试班" \
  http://localhost:8080/admin/updateStudentClass

# 5. 再次查询确认更新成功
curl -X GET http://localhost:8080/admin/listStudents

# 6. 删除用户
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "userType=1&userId=lifecycle_test" \
  http://localhost:8080/admin/delete

# 7. 最后查询确认删除成功
curl -X GET http://localhost:8080/admin/listStudents
```

---

## 8. 测试数据清理

### 8.1 清理测试数据脚本
```bash
#!/bin/bash
# cleanup_test_data.sh

echo "开始清理测试数据..."

# 删除测试学生
test_students=("s20250602001" "lifecycle_test")
for student in "${test_students[@]}"; do
  curl -X POST \
    -H "Content-Type: application/x-www-form-urlencoded" \
    -d "userType=1&userId=$student" \
    http://localhost:8080/admin/delete
  echo "删除学生: $student"
done

# 删除测试教师  
test_teachers=("t20250602001" "t20250602002")
for teacher in "${test_teachers[@]}"; do
  curl -X POST \
    -H "Content-Type: application/x-www-form-urlencoded" \
    -d "userType=2&userId=$teacher" \
    http://localhost:8080/admin/delete
  echo "删除教师: $teacher"
done

# 删除批量测试数据
for i in {1..10}; do
  curl -X POST \
    -H "Content-Type: application/x-www-form-urlencoded" \
    -d "userType=1&userId=batch_s$i" \
    http://localhost:8080/admin/delete
done

echo "测试数据清理完成"
```

---

## 测试结果记录模板

### 测试执行记录表

| 测试编号 | 测试功能 | 测试步骤 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|---------|---------|---------|---------|---------|---------|------|
| T001 | 注册学生用户 | 执行正常学生注册命令 | 返回成功状态码200 | | ✅/❌ | |
| T002 | 注册教师用户 | 执行正常教师注册命令 | 返回成功状态码200 | | ✅/❌ | |
| T003 | 查询用户列表 | 执行listUsers命令 | 返回用户列表JSON | | ✅/❌ | |
| T004 | 更新用户信息 | 执行update命令 | 返回更新成功消息 | | ✅/❌ | |
| T005 | 删除用户账户 | 执行delete命令 | 返回删除成功消息 | | ✅/❌ | |

### 测试总结

- **测试时间**: ___________
- **测试人员**: ___________
- **测试环境**: ___________
- **总测试用例数**: ___________
- **通过用例数**: ___________
- **失败用例数**: ___________
- **测试覆盖率**: ___________%

### 问题汇总

| 问题编号 | 问题描述 | 严重程度 | 发现时间 | 解决状态 |
|---------|---------|---------|---------|---------|
| | | | | |

---

**注意事项**:
1. 执行测试前请确保后端服务正常运行
2. 测试完成后请及时清理测试数据
3. 如发现API响应与预期不符，请记录详细的错误信息
4. 建议在不同环境（开发、测试、生产前）重复执行这些测试用例
